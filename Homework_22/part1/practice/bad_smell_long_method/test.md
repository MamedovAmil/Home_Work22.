три функции должны быть вынесены в отдельные методы
чтение из файла
сортировка
фильтрация 

эти методы должны быть по возможности короче чем изначально